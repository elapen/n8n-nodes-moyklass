# Release Notes v1.6.3

## Дата релиза
22 октября 2025

## Исправления ошибок (Bug Fixes)

### Исправлена передача атрибутов типа список (select/multiselect)

**Проблема:**
При создании или обновлении клиента кастомные атрибуты типа "список" (select) и "множественный выбор" (multiselect) не передавались в MoyKlass. Например, атрибуты "Язык" и "Формат обучения" не устанавливались, хотя пользователь указывал их значения в n8n.

**Причина:**
API MoyKlass возвращает список возможных значений атрибута в поле `variants`, а наш код искал это поле под названиями `values`, `selectOptions` или `options`. Из-за этого система не могла найти соответствующий ID для текстового значения и не отправляла атрибут в API.

**Решение:**
Обновлен модуль `AttributeHelper.ts` для поддержки поля `variants`:
- Добавлена поддержка поля `variants` в интерфейс `AttributeInfo`
- Обновлена логика поиска значений атрибутов: теперь сначала проверяется `variants`, затем остальные поля
- Код теперь корректно преобразует текстовые значения (например, "Русский язык") в `valueId` для API

**Затронутые атрибуты:**
- Все атрибуты типа `select` (одиночный выбор)
- Все атрибуты типа `multiselect` (множественный выбор)

**Тестирование:**
Проверено на реальных данных с атрибутами:
- ✅ "Язык" - select атрибут с вариантами "Английский", "Русский язык"
- ✅ "Формат обучения" - select атрибут с вариантами "Пакет Группа", "Пакет Жеке Start", "Пакет Жеке VIP"
- ✅ Текстовые атрибуты (string)
- ✅ Числовые атрибуты (number)

## Подтвержденная работоспособность полей

В ходе тестирования также подтверждена корректная работа следующих полей при создании клиента:
- ✅ **Филиалы (filials)** - передаются и сохраняются корректно
- ✅ **Статус клиента (clientStateId)** - передается и сохраняется корректно
- ⚠️ **Комментарий (comment)** - принимается API при создании, но не возвращается в ответе (особенность API MoyKlass)

## Технические детали

### Изменённые файлы
- `nodes/MoyKlass/helpers/AttributeHelper.ts`

### Миграция
Не требуется. Изменения обратно совместимы.

## Пример использования

### До исправления
```json
{
  "attributes": [
    {
      "attributeId": "16446",
      "value": "Русский язык"
    }
  ]
}
```
❌ Атрибут не устанавливался

### После исправления
```json
{
  "attributes": [
    {
      "attributeId": "16446",
      "value": "Русский язык"
    }
  ]
}
```
✅ Атрибут корректно устанавливается с `valueId: 245013`

## Благодарности
Спасибо пользователям за подробный отчёт о проблеме с реальными примерами данных, что помогло быстро выявить и исправить ошибку.

